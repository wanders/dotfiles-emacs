<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Anders Waldenborg's emacs config</title>
<!-- 2014-11-03 Mon 22:41 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Anders Waldenborg" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Anders Waldenborg's emacs config</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#Packages">1. Packages</a></li>
<li><a href="#Appearance">2. Appearance</a>
<ul>
<li><a href="#Appearance-Remove.stuff.from.the.UI.">2.1. Remove stuff from the UI.</a></li>
<li><a href="#Appearance-Show.matching.parens">2.2. Show matching parens</a></li>
<li><a href="#Appearance-Large.frame">2.3. Large frame</a></li>
<li><a href="#Appearance-Header.line">2.4. Header line</a></li>
<li><a href="#Appearance-ANSI.colors">2.5. ANSI colors</a></li>
</ul>
</li>
<li><a href="#yankmenu">3. yankmenu</a></li>
<li><a href="#woman">4. woman</a></li>
<li><a href="#flymake">5. flymake</a></li>
<li><a href="#key.bindings">6. key-bindings</a>
<ul>
<li><a href="#key.bindings-C.c..letter.">6.1. C-c <i>letter</i></a></li>
</ul>
</li>
<li><a href="#c.mode">7. c-mode</a></li>
<li><a href="#flyspell">8. flyspell</a></li>
<li><a href="#shell">9. shell</a></li>
<li><a href="#shell.script.mode">10. shell script mode</a></li>
<li><a href="#uniquify">11. uniquify</a></li>
<li><a href="#python">12. python</a></li>
<li><a href="#ido">13. ido</a></li>
<li><a href="#git">14. git</a>
<ul>
<li><a href="#git-git.rebase..i.todo.mode.">14.1. git rebase -i todo mode.</a></li>
<li><a href="#git-Fast.import">14.2. Fast import</a></li>
</ul>
</li>
<li><a href="#org">15. org</a>
<ul>
<li><a href="#org-Auto.byte.compile.after.tangling.to..el.file">15.1. Auto byte compile after tangling to .el file</a></li>
<li><a href="#org-Use.the.heading.path.as.CUSTOM.ID.for.export.">15.2. Use the heading-path as CUSTOM<sub>ID</sub> for export.</a></li>
<li><a href="#org-init.el.in.org.git.export">15.3. init.el in org git export</a></li>
</ul>
</li>
<li><a href="#nxml">16. nxml</a></li>
</ul>
</div>
</div>
<p>
##
## Use org-babel-tangle to write the .el file.
##
</p>


<div id="outline-container-Packages" class="outline-2">
<h2 id="Packages"><a id="sec-1" name="sec-1"></a><span class="section-number-2">1</span> Packages</h2>
<div class="outline-text-2" id="text-Packages">

<p>
Initialize package system and add the marmalade and melpa package
repositories. This snippet comes from <a href="http://irreal.org/blog/?p=923">http://irreal.org/blog/?p=923</a>
</p>

<p>
Rumor has that it should be the very first thing in init.el, so here
we go.
</p>

<p>
On older emacs (but probably only works on emacs 23) it tries to load
package.el from .emacs.d. The last version that works on emacs23
should be:
<a href="http://git.savannah.gnu.org/cgit/emacs.git/plain/lisp/emacs-lisp/package.el?id=1a0a666f941c99882093d7bd08ced15033bc3f0c">http://git.savannah.gnu.org/cgit/emacs.git/plain/lisp/emacs-lisp/package.el?id=1a0a666f941c99882093d7bd08ced15033bc3f0c</a>
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">  (<span style="color: #a020f0;">when</span> (or (&gt;= emacs-major-version 24)
            (load (locate-user-emacs-file <span style="color: #8b2252;">"package.el"</span>) t))
    (package-initialize)
    (add-to-list 'package-archives
                 '(<span style="color: #8b2252;">"marmalade"</span> . <span style="color: #8b2252;">"http://marmalade-repo.org/packages/"</span>))
    (add-to-list 'package-archives
                 '(<span style="color: #8b2252;">"melpa"</span> . <span style="color: #8b2252;">"http://melpa.milkbox.net/packages/"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-Appearance" class="outline-2">
<h2 id="Appearance"><a id="sec-2" name="sec-2"></a><span class="section-number-2">2</span> Appearance</h2>
<div class="outline-text-2" id="text-Appearance">
</div>

<div id="outline-container-Appearance-Remove.stuff.from.the.UI." class="outline-3">
<h3 id="Appearance-Remove.stuff.from.the.UI."><a id="sec-2-1" name="sec-2-1"></a><span class="section-number-3">2.1</span> Remove stuff from the UI.</h3>
<div class="outline-text-3" id="text-Appearance-Remove.stuff.from.the.UI.">

<p>
By default emacs has lots of useless UI elements, remove them to give
more room for the actual edit buffers.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(blink-cursor-mode 0)

(menu-bar-mode 0)
(tool-bar-mode 0)
(scroll-bar-mode 0)
</pre>
</div>

<p>
Now with the scrollbar out of the way, add some information about
buffer boundaries in the left fringe.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq-default indicate-buffer-boundaries 'left)
(setq-default indicate-empty-lines t)
</pre>
</div>
</div>
</div>

<div id="outline-container-Appearance-Show.matching.parens" class="outline-3">
<h3 id="Appearance-Show.matching.parens"><a id="sec-2-2" name="sec-2-2"></a><span class="section-number-3">2.2</span> Show matching parens</h3>
<div class="outline-text-3" id="text-Appearance-Show.matching.parens">

<p>
Showing matching parentheses is nice. Having the whole expression
within parens highlighted when cursor is on one of the parens is even
nicer.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(show-paren-mode t)
(set-face-background 'show-paren-mismatch-face <span style="color: #8b2252;">"red"</span>)
(set-face-background 'show-paren-match-face <span style="color: #8b2252;">"#f0f0f0"</span>)
(setq show-paren-style 'expression)
</pre>
</div>


<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Hilight trailing whitespace</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">like this --&gt;   </span>
<span style="color: #b22222;">;;</span>
(setq-default show-trailing-whitespace t)
(set-face-background 'trailing-whitespace <span style="color: #8b2252;">"orange1"</span>)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq compilation-scroll-output t)

(transient-mark-mode t)
(setq mouse-yank-at-point t)

(setq user-mail-address <span style="color: #8b2252;">"anders@0x63.nu"</span>)
(setq inhibit-startup-screen t)
(setq calendar-week-start-day 1)
</pre>
</div>
</div>
</div>

<div id="outline-container-Appearance-Large.frame" class="outline-3">
<h3 id="Appearance-Large.frame"><a id="sec-2-3" name="sec-2-3"></a><span class="section-number-3">2.3</span> Large frame</h3>
<div class="outline-text-3" id="text-Appearance-Large.frame">

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq aw-default-font <span style="color: #8b2252;">"Inconsolata-10"</span>)

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-large-frame</span> ()
  <span style="color: #8b2252;">"Create a new fullscreen frame with a larger font (for pair programming/review)"</span>
  (interactive)
  (message <span style="color: #8b2252;">"aw-large-frame requires emacs23"</span>))

(<span style="color: #a020f0;">when</span> (&gt;= emacs-major-version 23)
  (set-frame-font aw-default-font t)
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-new-frame-set-font-function</span> (frame)
    <span style="color: #8b2252;">""</span>
    (<span style="color: #a020f0;">with-selected-frame</span> frame
      (set-frame-font aw-default-font nil)))

  (add-hook 'after-make-frame-functions 'aw-new-frame-set-font-function)

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-large-frame</span> ()
    <span style="color: #8b2252;">"Create a new fullscreen frame with a larger font (for pair programming/review)"</span>
    (interactive)
    (<span style="color: #a020f0;">with-selected-frame</span> (make-frame '((name . <span style="color: #8b2252;">"Emacs Largefont frame"</span>)
                                       (window-system . x)))
      (set-frame-font <span style="color: #8b2252;">"Inconsolata-16"</span> t)
      (set-frame-parameter nil 'fullscreen 'fullboth)
      (selected-frame))))
</pre>
</div>
</div>
</div>

<div id="outline-container-Appearance-Header.line" class="outline-3">
<h3 id="Appearance-Header.line"><a id="sec-2-4" name="sec-2-4"></a><span class="section-number-3">2.4</span> Header line</h3>
<div class="outline-text-3" id="text-Appearance-Header.line">

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">headerline contains current function and flymake error on current line</span>
(which-func-mode t)
(setq-default header-line-format
              '(
                (which-func-mode which-func-format)
                (flymake-mode (<span style="color: #8b2252;">" "</span> (<span style="color: #483d8b;">:eval</span> (aw-flymake-get-err))))
                ))
</pre>
</div>
</div>
</div>

<div id="outline-container-Appearance-ANSI.colors" class="outline-3">
<h3 id="Appearance-ANSI.colors"><a id="sec-2-5" name="sec-2-5"></a><span class="section-number-3">2.5</span> ANSI colors</h3>
<div class="outline-text-3" id="text-Appearance-ANSI.colors">

<p>
With white background the default ANSI colors gets a bit too
bright. Tune them down a bit.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">eval-after-load</span> 'ansi-color
  '(<span style="color: #a020f0;">progn</span>
     (setq ansi-color-names-vector
           [<span style="color: #8b2252;">"black"</span> <span style="color: #8b2252;">"#600"</span> <span style="color: #8b2252;">"#060"</span> <span style="color: #8b2252;">"#660"</span>
            <span style="color: #8b2252;">"#006"</span> <span style="color: #8b2252;">"#066"</span> <span style="color: #8b2252;">"#606"</span> <span style="color: #8b2252;">"white"</span>])
     (setq ansi-color-map (ansi-color-make-color-map))))
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-yankmenu" class="outline-2">
<h2 id="yankmenu"><a id="sec-3" name="sec-3"></a><span class="section-number-2">3</span> yankmenu</h2>
<div class="outline-text-2" id="text-yankmenu">
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">store symbol at point to killring</span>
<span style="color: #b22222;">;;</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-kill-ring-save-symbol</span> ()
  <span style="color: #8b2252;">"Copy the symbol under point to the killring."</span>
  (interactive)
  (<span style="color: #a020f0;">let</span> ((b (bounds-of-thing-at-point 'symbol)))
    (kill-ring-save (car b) (cdr b))))

<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Stuff for popping up the yankmenu popup</span>
<span style="color: #b22222;">;;</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-popup-menu-at-point</span> (menu)
  <span style="color: #8b2252;">"Shows popup menu at current point, not where mouse pointer happens to be"</span>
  (<span style="color: #a020f0;">let*</span> ((pos (posn-at-point))
         (x (car (posn-x-y pos)))
         (y (cdr (posn-x-y pos)))
         (win (posn-window pos)))
    
    (popup-menu menu (list (list x y) win))))


(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-yankmenu-popup</span> ()
  <span style="color: #8b2252;">""</span>
  (interactive)
  (aw-popup-menu-at-point 'yank-menu))
</pre>
</div>
</div>
</div>

<div id="outline-container-woman" class="outline-2">
<h2 id="woman"><a id="sec-4" name="sec-4"></a><span class="section-number-2">4</span> woman</h2>
<div class="outline-text-2" id="text-woman">
<div class="org-src-container">

<pre class="src src-emacs-lisp">  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Customizations for woman manual viewer</span>
  
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">woman</span>)
  
  (setq woman-use-own-frame nil)
  
  
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Stuff for grabbing headers from man pages</span>
  <span style="color: #b22222;">;;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Pressing 'h' in a woman buffer grabs all #include lines and puts them in the kill ring</span>
  <span style="color: #b22222;">;;</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-interesting-beginning-of-line</span> ()
    <span style="color: #8b2252;">""</span>
    (<span style="color: #a020f0;">save-excursion</span>
      (beginning-of-line)
      (<span style="color: #a020f0;">while</span> (looking-at <span style="color: #8b2252;">"[\t ]"</span>)
        (forward-char))
      (point)))
  
  
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-interesting-end-of-line</span> ()
    <span style="color: #8b2252;">""</span>
    (<span style="color: #a020f0;">save-excursion</span>
      (end-of-line)
      (<span style="color: #a020f0;">while</span> (looking-at <span style="color: #8b2252;">"[\t ]"</span>)
        (backward-char))
      (point)))
  
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-current-interesting-line</span> ()
    <span style="color: #8b2252;">""</span>
    (buffer-substring-no-properties
     (aw-interesting-beginning-of-line)
     (aw-interesting-end-of-line)))
  
  
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-grab-includes-from-woman</span> ()
    <span style="color: #8b2252;">""</span>
    (interactive)
    (<span style="color: #a020f0;">save-excursion</span>
      (goto-char (point-min))
      (<span style="color: #a020f0;">while</span> (not (looking-at <span style="color: #8b2252;">"SYNOPSIS"</span>))
        (forward-line))
      (<span style="color: #a020f0;">let</span> ((s <span style="color: #8b2252;">""</span>))
        (<span style="color: #a020f0;">while</span> (not (looking-at <span style="color: #8b2252;">"DESCRIPTION"</span>))
          (<span style="color: #a020f0;">if</span> (looking-at <span style="color: #8b2252;">"[         ]*#include"</span>)
              (setq s (concat s (aw-current-interesting-line) <span style="color: #8b2252;">"\n"</span>)))
          (forward-line))
        (kill-new s))))
  
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-woman-hook</span> ()
    <span style="color: #8b2252;">""</span>
    (define-key woman-mode-map <span style="color: #8b2252;">"h"</span> 'aw-grab-includes-from-woman))
  
  (add-hook 'woman-mode-hook 'aw-woman-hook)
</pre>
</div>
</div>
</div>

<div id="outline-container-flymake" class="outline-2">
<h2 id="flymake"><a id="sec-5" name="sec-5"></a><span class="section-number-2">5</span> flymake</h2>
<div class="outline-text-2" id="text-flymake">
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">customizations for flymake</span>


(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">flymake</span>)

<span style="color: #b22222;">; </span><span style="color: #b22222;">no ugly gui warnings when flymake can't be enabled</span>
(setq flymake-gui-warnings-enabled nil)

<span style="color: #b22222;">; </span><span style="color: #b22222;">some logging</span>
(setq flymake-log-level 0)

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-flymake-if-buffer-isnt-tramp</span> ()
  (<span style="color: #a020f0;">if</span> (not (and (boundp 'tramp-file-name-structure)
                (string-match (car tramp-file-name-structure) (buffer-file-name))))
      (flymake-mode t)))

<span style="color: #b22222;">; </span><span style="color: #b22222;">enables flymake mode iff buffer has a filename set,</span>
<span style="color: #b22222;">; </span><span style="color: #b22222;">otherwise things breaks badly for things such as emerge</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-flymake-if-buffer-has-filename</span> ()
  (<span style="color: #a020f0;">if</span> (buffer-file-name)
      (aw-flymake-if-buffer-isnt-tramp)))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-flymake-get-err</span> ()
  <span style="color: #8b2252;">"Gets first error message for current line"</span>
  (<span style="color: #a020f0;">let</span> ((fm-err (car (flymake-find-err-info flymake-err-info (flymake-current-line-no)))))
    (<span style="color: #a020f0;">if</span> fm-err
        (flymake-ler-text (nth 0 fm-err)))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-flymake-display-err</span> ()
  (interactive)
  (<span style="color: #a020f0;">let</span> ((err (aw-flymake-get-err)))
    (message (format <span style="color: #8b2252;">"FLYMAKE: %s"</span> err))))

(<span style="color: #a020f0;">defmacro</span> <span style="color: #0000ff;">aw-flymake-add-simple</span> (ptrn cmd)
  `(add-to-list 'flymake-allowed-file-name-masks
                (list ,ptrn
                      (<span style="color: #a020f0;">lambda</span> ()
                        (<span style="color: #a020f0;">let*</span> ((temp-file (flymake-init-create-temp-buffer-copy
                                           'flymake-create-temp-inplace))
                               (local-file (file-relative-name 
                                            temp-file
                                            (file-name-directory buffer-file-name))))
                          (list ,cmd (list local-file)))))))



<span style="color: #b22222;">; </span><span style="color: #b22222;">enable flymake on c</span>
<span style="color: #b22222;">;</span><span style="color: #b22222;">(add-hook 'c-mode-hook 'aw-flymake-if-buffer-has-filename t)</span>
<span style="color: #b22222;">; </span><span style="color: #b22222;">enable flymake on py</span>
<span style="color: #b22222;">;</span><span style="color: #b22222;">(add-hook 'python-mode-hook 'aw-flymake-if-buffer-has-filename t)</span>

<span style="color: #b22222;">; </span><span style="color: #b22222;">Or lets do a global enable global enable</span>
(add-hook 'find-file-hook 'aw-flymake-if-buffer-has-filename)
</pre>
</div>
</div>
</div>

<div id="outline-container-key.bindings" class="outline-2">
<h2 id="key.bindings"><a id="sec-6" name="sec-6"></a><span class="section-number-2">6</span> key-bindings</h2>
<div class="outline-text-2" id="text-key.bindings">

<p>
I've never understood the default goto-line keybinding, so I've put
goto-line directly on M-g.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(global-set-key <span style="color: #8b2252;">"\M-g"</span> 'goto-line)
</pre>
</div>


<p>
The M-s prefix has several search things by default. Lets add a second
level prefix "M-s t" as a prefix for tags stuff:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(global-set-key <span style="color: #8b2252;">"\M-sts"</span> 'tags-search)
(global-set-key <span style="color: #8b2252;">"\M-stf"</span> 'aw-ido-find-tag)
(global-set-key <span style="color: #8b2252;">"\M-stv"</span> 'visit-tags-file)
(global-set-key <span style="color: #8b2252;">"\M-st%"</span> 'tags-query-replace)
(global-set-key <span style="color: #8b2252;">"\M-stn"</span> 'tags-loop-continue)
</pre>
</div>

<p>
&#x2026;and while we are at it, replace the default M-. with the ido enhanced variant:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(global-set-key <span style="color: #8b2252;">"\M-."</span> 'aw-ido-find-tag)
</pre>
</div>



<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #b22222;">; </span><span style="color: #b22222;">Adapted from andre, who probably borrowed it from someone else.</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">cut-or-kill</span> ()
  <span style="color: #8b2252;">"If the mark is active - kill region, otherwise backward-kill-word"</span>
  (interactive)
  (<span style="color: #a020f0;">if</span> mark-active
      (kill-region (point) (mark))
    (backward-kill-word 1)))

(global-set-key <span style="color: #8b2252;">"\C-w"</span> 'cut-or-kill)
</pre>
</div>


<p>
Default "C-h a" binding is apropos-command, which is useless. I
mostly use apropos when coding elisp and want full apropos
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(define-key help-map <span style="color: #8b2252;">"a"</span> 'apropos)
</pre>
</div>


<p>
describe-text-properties is sometimes useful when developing
elisp, and it is some kind of help, so stick it under C-h
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(define-key help-map <span style="color: #8b2252;">"x"</span> 'describe-text-properties)
</pre>
</div>



<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #b22222;">; </span><span style="color: #b22222;">C-x 5 l =&gt; create new "large" frame. A fullscreen frame with larger</span>
<span style="color: #b22222;">;            </span><span style="color: #b22222;">font is nice for pair-programming/review.</span>
(define-key ctl-x-5-map <span style="color: #8b2252;">"l"</span> 'aw-large-frame)
</pre>
</div>
</div>


<div id="outline-container-key.bindings-C.c..letter." class="outline-3">
<h3 id="key.bindings-C.c..letter."><a id="sec-6-1" name="sec-6-1"></a><span class="section-number-3">6.1</span> C-c <i>letter</i></h3>
<div class="outline-text-3" id="text-key.bindings-C.c..letter.">

<p>
C-c <i>letter</i> bindings are free for users to define.
This is how I define them.
</p>


<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #b22222;">; </span><span style="color: #b22222;">"C-c w" =&gt; Add symbol under cursor to kill ring. When programming I</span>
<span style="color: #b22222;">;            </span><span style="color: #b22222;">often write a call to a new function that I need to write</span>
<span style="color: #b22222;">;            </span><span style="color: #b22222;">before writing the actual function, and use this to get</span>
<span style="color: #b22222;">;            </span><span style="color: #b22222;">the name into the key ring for easy paste when writing</span>
<span style="color: #b22222;">;            </span><span style="color: #b22222;">the actual function.</span>
(global-set-key <span style="color: #8b2252;">"\C-cw"</span> 'aw-kill-ring-save-symbol)
(global-set-key <span style="color: #8b2252;">"\C-cy"</span> 'aw-yankmenu-popup)
(global-set-key <span style="color: #8b2252;">"\C-cn"</span> 'flymake-goto-next-error)
(global-set-key <span style="color: #8b2252;">"\C-cd"</span> 'dictionary-search)

(global-set-key <span style="color: #8b2252;">"\C-cg"</span> 'aw-ido-imenu-goto)

<span style="color: #b22222;">; </span><span style="color: #b22222;">The orgtbl is really nice, make it easy to enable it on demand</span>
(global-set-key <span style="color: #8b2252;">"\C-ct"</span> 'orgtbl-mode)

<span style="color: #b22222;">; </span><span style="color: #b22222;">I use untabify often enough to warrant it on a key, and lets use my</span>
<span style="color: #b22222;">; </span><span style="color: #b22222;">variant that untabifies up to end of line if there is no region.</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-untabify-region-or-to-eol</span> ()
  (interactive)
  (<span style="color: #a020f0;">if</span> mark-active
      (untabify (region-beginning) (region-end))
    (untabify (point) (point-at-eol))))
(global-set-key <span style="color: #8b2252;">"\C-cu"</span> 'aw-untabify-region-or-to-eol)


(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-ensure-python-buffer-visible</span> ()
  (interactive)
  (<span style="color: #a020f0;">if</span> python-buffer
      (switch-to-buffer-other-window python-buffer t)
    (message <span style="color: #8b2252;">"No python buffer available"</span>)))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-ensure-interesting-buffer-visible</span> ()
  (interactive)
  (<span style="color: #a020f0;">if</span> (derived-mode-p 'python-mode)
      (aw-ensure-python-buffer-visible)
    (message <span style="color: #8b2252;">"Don't know about interesting buffers for this mode"</span>)))

(global-set-key <span style="color: #8b2252;">"\C-ci"</span> 'aw-ensure-interesting-buffer-visible)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-c.mode" class="outline-2">
<h2 id="c.mode"><a id="sec-7" name="sec-7"></a><span class="section-number-2">7</span> c-mode</h2>
<div class="outline-text-2" id="text-c.mode">

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-str-isprefixp</span> (str prefix)
  <span style="color: #8b2252;">""</span>
  (<span style="color: #a020f0;">let</span> ((plen (length prefix)))
    (and (&gt;= (length str) plen)
         (string-equal prefix (substring str 0 plen)))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-as-autostyles</span> ()
  <span style="color: #8b2252;">""</span>
  (<span style="color: #a020f0;">let</span> (res)
    (<span style="color: #a020f0;">dolist</span> (stylename (mapcar 'car c-style-alist) res)
      (<span style="color: #a020f0;">if</span> (aw-str-isprefixp stylename <span style="color: #8b2252;">"auto-"</span>)
          (setq res (cons (substring stylename 5) res))))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-list-str-match</span> (lst x)
  <span style="color: #8b2252;">"Return first matching entry in list of patterns"</span>
  (<span style="color: #a020f0;">if</span> lst
      (<span style="color: #a020f0;">if</span> (string-match (car lst) x)
          (car lst)
        (aw-list-str-match (cdr lst) x))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-as-find-match</span> (matches p)
  <span style="color: #8b2252;">""</span>
  (<span style="color: #a020f0;">if</span> p
      (or
       (aw-list-str-match matches (car p))
       (aw-as-find-match matches (cdr p)))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-as-hook</span> ()
  <span style="color: #8b2252;">""</span>
  (<span style="color: #a020f0;">when</span> (buffer-file-name)
    (message (format <span style="color: #8b2252;">"Looking for style for %s"</span> (buffer-file-name)))
    (<span style="color: #a020f0;">let</span> ((x (aw-as-find-match (aw-as-autostyles) (split-string (buffer-file-name)))))
      (<span style="color: #a020f0;">when</span> x
        (message <span style="color: #8b2252;">"Using C style %s"</span> x)
        (c-set-style (concat <span style="color: #8b2252;">"auto-"</span> x))))))



<span style="color: #b22222;">; </span><span style="color: #b22222;">This is based on the trick described here: http://www.emacswiki.org/emacs/SmartTabs</span>
<span style="color: #b22222;">; </span><span style="color: #b22222;">but instead of macros-generating-advices it uses the indent-line-function variable</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-c-smarttab-indent-line-function</span> ()
  (<span style="color: #a020f0;">cond</span>
   (indent-tabs-mode
    (<span style="color: #a020f0;">let</span> ((c-basic-offset fill-column)
          (tab-width fill-column))
      (c-indent-line)))
   (t (c-indent-line))))

<span style="color: #b22222;">;</span>
(c-add-style <span style="color: #8b2252;">"aw-base"</span>
             '(<span style="color: #8b2252;">"linux"</span>
               (tab-width . 4)
               (c-basic-offset . 4)
               (c-offsets-alist . ((case-label . +)))
               (indent-line-function . aw-c-smarttab-indent-line-function)
               ))



<span style="color: #b22222;">;;</span>

(c-add-style <span style="color: #8b2252;">"auto-packetlogic2*"</span>
             '(<span style="color: #8b2252;">"aw-base"</span>))

<span style="color: #b22222;">; </span><span style="color: #b22222;">use a strange offset to catch indentation errors.</span>
(c-add-style <span style="color: #8b2252;">"auto-xmms2*"</span>
             '(<span style="color: #8b2252;">"aw-base"</span>
               (tab-width . 5)
               (c-basic-offset . 5)))

(c-add-style <span style="color: #8b2252;">"auto-kernel*"</span>
             '(<span style="color: #8b2252;">"linux"</span>))

(c-add-style <span style="color: #8b2252;">"auto-/*"</span>
             '(<span style="color: #8b2252;">"aw-base"</span>))

(add-hook 'c-mode-hook 'aw-as-hook)

<span style="color: #b22222;">; </span><span style="color: #b22222;">enable flyspell in C sources.</span>
(add-hook 'c-mode-hook 'flyspell-prog-mode t)
</pre>
</div>
</div>
</div>

<div id="outline-container-flyspell" class="outline-2">
<h2 id="flyspell"><a id="sec-8" name="sec-8"></a><span class="section-number-2">8</span> flyspell</h2>
<div class="outline-text-2" id="text-flyspell">

<p>
Make flyspell use wave underlines in emacs 24.3+.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">eval-after-load</span> 'flyspell
  '(<span style="color: #a020f0;">when</span> (or (&gt; emacs-major-version 24)
            (and (= emacs-major-version 24) (&gt;= emacs-minor-version 3)))
    (set-face-attribute 'flyspell-incorrect nil
                        <span style="color: #483d8b;">:inherit</span> nil
                        <span style="color: #483d8b;">:underline</span> '(<span style="color: #483d8b;">:color</span> <span style="color: #8b2252;">"#cc0000"</span> <span style="color: #483d8b;">:style</span> wave))
    (set-face-attribute 'flyspell-duplicate nil
                        <span style="color: #483d8b;">:inherit</span> nil
                        <span style="color: #483d8b;">:underline</span> '(<span style="color: #483d8b;">:color</span> <span style="color: #8b2252;">"#00cc00"</span> <span style="color: #483d8b;">:style</span> wave))))
</pre>
</div>
</div>
</div>

<div id="outline-container-shell" class="outline-2">
<h2 id="shell"><a id="sec-9" name="sec-9"></a><span class="section-number-2">9</span> shell</h2>
<div class="outline-text-2" id="text-shell">

<p>
Use directory tracking to get the current directory in shell buffers
name. The idea is to be able to easily switch to the right buffer with
ido buffer switching.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-directory-shell-buffer-name-mode-func</span> (s)
  (rename-buffer (format <span style="color: #8b2252;">"*shell[%s]*"</span> (abbreviate-file-name (directory-file-name default-directory))) t))

(<span style="color: #a020f0;">define-minor-mode</span> <span style="color: #0000ff;">aw-directory-shell-buffer-name-mode</span>
  <span style="color: #8b2252;">""</span>
  nil nil nil
  (<span style="color: #a020f0;">if</span> aw-directory-shell-buffer-name-mode
      (<span style="color: #a020f0;">progn</span>
        (aw-directory-shell-buffer-name-mode-func <span style="color: #8b2252;">""</span>)
        (add-hook 'comint-input-filter-functions 'aw-directory-shell-buffer-name-mode-func t t))
    (remove-hook 'comint-input-filter-functions 'aw-directory-shell-buffer-name-mode-func t)))

(add-hook 'shell-mode-hook '(<span style="color: #a020f0;">lambda</span> () (aw-directory-shell-buffer-name-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-shell.script.mode" class="outline-2">
<h2 id="shell.script.mode"><a id="sec-10" name="sec-10"></a><span class="section-number-2">10</span> shell script mode</h2>
<div class="outline-text-2" id="text-shell.script.mode">

<p>
Basic setup for indentation in buffers editing shell scripts. Notice
sh-indent-comment to allow indentation of comment (only) lines.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-setup-sh-mode</span> ()
  (setq tab-width 8)
  (setq sh-indentation 8)
  (setq sh-basic-offset 8)
  (setq sh-indent-comment t))

(add-hook 'sh-mode-hook 'aw-setup-sh-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-uniquify" class="outline-2">
<h2 id="uniquify"><a id="sec-11" name="sec-11"></a><span class="section-number-2">11</span> uniquify</h2>
<div class="outline-text-2" id="text-uniquify">

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">uniquify</span>)

<span style="color: #b22222;">; </span><span style="color: #b22222;">server/src/foo.c client/src/foo.c</span>
<span style="color: #b22222;">; </span><span style="color: #b22222;">=&gt;</span>
<span style="color: #b22222;">; </span><span style="color: #b22222;">foo.c&lt;server&gt;    foo.c&lt;client&gt;</span>
(setq uniquify-buffer-name-style 'post-forward-angle-brackets)
(setq uniquify-strip-common-suffix t)

<span style="color: #b22222;">; </span><span style="color: #b22222;">Rename buffers on close.</span>
(setq uniquify-after-kill-buffer-p t)


<span style="color: #b22222;">; </span><span style="color: #b22222;">Don't try to be clever on *buffers*</span>
(setq uniquify-ignore-buffers-re <span style="color: #8b2252;">"^\\*"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-python" class="outline-2">
<h2 id="python"><a id="sec-12" name="sec-12"></a><span class="section-number-2">12</span> python</h2>
<div class="outline-text-2" id="text-python">

<div class="org-src-container">

<pre class="src src-emacs-lisp">(add-hook 'python-mode-hook 'flyspell-prog-mode t)

<span style="color: #b22222;">; </span><span style="color: #b22222;">waf's wscript files are python</span>
(add-to-list 'auto-mode-alist '(<span style="color: #8b2252;">"wscript"</span> . python-mode))

<span style="color: #b22222;">; </span><span style="color: #b22222;">Add align rules for python dicts.</span>
<span style="color: #b22222;">; </span><span style="color: #b22222;">e.g allow using "C-u M-x align" to get pretty things like:</span>
<span style="color: #b22222;">; </span><span style="color: #b22222;">mydict = {</span>
<span style="color: #b22222;">;     </span><span style="color: #b22222;">a:        10,</span>
<span style="color: #b22222;">;     </span><span style="color: #b22222;">bbbbbb:   20,</span>
<span style="color: #b22222;">;     </span><span style="color: #b22222;">ccc:      30,</span>
<span style="color: #b22222;">; </span><span style="color: #b22222;">}</span>
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">align</span>)
(add-to-list 'align-rules-list '(python-dict
                                 (regexp . <span style="color: #8b2252;">":</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(</span><span style="color: #8b2252;">\\s-*</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252;">[</span><span style="color: #8b2252;">^</span><span style="color: #8b2252;">#\t\n ]"</span>)
                                 (modes . '(python-mode))))



<span style="color: #b22222;">; </span><span style="color: #b22222;">some debian startup file adds pylint-python-hook that is broken on my system</span>
(remove-hook 'python-mode-hook 'pylint-python-hook)


<span style="color: #b22222;">;; </span><span style="color: #b22222;">use pyflakes to check .py files.</span>
(aw-flymake-add-simple <span style="color: #8b2252;">"\\.py\\'"</span> <span style="color: #8b2252;">"pyflakes"</span>)
<span style="color: #b22222;">;; </span><span style="color: #b22222;">and pyrexc to check .pyx files.</span>
(aw-flymake-add-simple <span style="color: #8b2252;">"\\.pyx\\'"</span> <span style="color: #8b2252;">"pyrexc"</span>)



(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-py-docstr-p</span> ()
  (<span style="color: #a020f0;">let*</span> ((ppss (syntax-ppss))
         (strbeg (nth 8 ppss)))
    (<span style="color: #a020f0;">when</span> strbeg
      (<span style="color: #a020f0;">save-excursion</span>
        (goto-char strbeg)
        (looking-at <span style="color: #8b2252;">"\"\"\""</span>)))))


(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-py-docstr-indent-previous-paragraph-indent-amout</span> (start default)
  (<span style="color: #a020f0;">catch</span> '<span style="color: #008b8b;">done</span>
    (<span style="color: #a020f0;">while</span> (looking-at <span style="color: #8b2252;">"^[[:blank:]]*$"</span>)
      (<span style="color: #a020f0;">if</span> (&gt; (point) start)
          (<span style="color: #a020f0;">throw</span> '<span style="color: #008b8b;">done</span> default))
      (forward-line -1))
    (<span style="color: #a020f0;">while</span> (not (looking-at <span style="color: #8b2252;">"^[[:blank:]]*$"</span>))
      (<span style="color: #a020f0;">if</span> (&gt; (point) start)
          (<span style="color: #a020f0;">throw</span> '<span style="color: #008b8b;">done</span> default))
      (forward-line -1))
    (forward-line 1)
    (<span style="color: #a020f0;">throw</span> '<span style="color: #008b8b;">done</span> (current-indentation))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-py-docstr-indent-amount</span> ()
  (<span style="color: #a020f0;">save-excursion</span>
    (<span style="color: #a020f0;">let*</span> ((T (<span style="color: #a020f0;">save-excursion</span>
                (goto-char (nth 8 (syntax-ppss)))
                (cons (point) (current-column))))
           (start (car T))
           (indent (cdr T)))
      (forward-line 0)
      (<span style="color: #a020f0;">if</span> (looking-at <span style="color: #8b2252;">"^[[:blank:]]*@.+: *"</span>)
          indent
        (forward-line -1)
        (<span style="color: #a020f0;">cond</span>
         <span style="color: #b22222;">;; </span><span style="color: #b22222;">first line - use same indent as multiline string itself</span>
         ((&lt; (point) start) indent)

         <span style="color: #b22222;">;; </span><span style="color: #b22222;">epydoc field - indent up to colon</span>
         ((looking-at <span style="color: #8b2252;">"^[[:blank:]]*@.+: *"</span>)
          (<span style="color: #a020f0;">save-excursion</span>
            (goto-char (match-end 0))
            (current-column)))

         <span style="color: #b22222;">;; </span><span style="color: #b22222;">blank line - find previous nonblank</span>
         ((looking-at <span style="color: #8b2252;">"^[[:blank:]]*$"</span>)
          (aw-py-docstr-indent-previous-paragraph-indent-amout start indent))

         <span style="color: #b22222;">;; </span><span style="color: #b22222;">default - same as previous line</span>
         (t (current-indentation)))))))


(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-py-docstr-indent-line-function</span> ()
  (<span style="color: #a020f0;">if</span> (not (aw-py-docstr-p))
      (python-indent-line)
    (indent-line-to (aw-py-docstr-indent-amount))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-py-docstr-fill-paragraph</span> (<span style="color: #228b22;">&amp;optional</span> justify region)
  <span style="color: #8b2252;">""</span>
  (interactive)
  (<span style="color: #a020f0;">let</span> ((paragraph-separate <span style="color: #8b2252;">"[ \t\\f]*</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(</span><span style="color: #8b2252;">@.*</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">|</span><span style="color: #8b2252;">\"\"\"[ \t\\f]*</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252;">?$"</span>)
        (paragraph-start <span style="color: #8b2252;">"[ \t\\f]*</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(</span><span style="color: #8b2252;">@.*</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">|</span><span style="color: #8b2252;">\"\"\"[ \t\\f]*</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252;">?$"</span>))
    (python-fill-paragraph)))


(add-hook 'python-mode-hook
          (<span style="color: #a020f0;">lambda</span> ()
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">I hope we can trust that these already are local...</span>
            (setq indent-line-function 'aw-py-docstr-indent-line-function)
            (setq fill-paragraph-function 'aw-py-docstr-fill-paragraph))
          t)
</pre>
</div>
</div>
</div>

<div id="outline-container-ido" class="outline-2">
<h2 id="ido"><a id="sec-13" name="sec-13"></a><span class="section-number-2">13</span> ido</h2>
<div class="outline-text-2" id="text-ido">

<p>
ido is really nice for finding files and buffer switching
</p>



<p>
Don't keep state between emacs invocations
(needs to be set before enabling ido-mode)
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq ido-save-directory-list-file nil)
</pre>
</div>

<p>
Load and enable ido
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ido</span>)
(ido-mode t)
</pre>
</div>

<p>
Make sure .pyx/.y/.l files comes before their C file friends.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq ido-file-extensions-order '(<span style="color: #8b2252;">".pyx"</span> <span style="color: #8b2252;">".y"</span> <span style="color: #8b2252;">".l"</span> t))
</pre>
</div>

<p>
Default is raise-frame, which most of the time is useless.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq ido-default-buffer-method 'selected-window)
</pre>
</div>


<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-ido-completing-read-with-default</span> (prompt entries predicate)
  (<span style="color: #a020f0;">let*</span> ((maybedft (find-tag-default))
         (compl (all-completions <span style="color: #8b2252;">""</span> entries predicate))
         (dft (assoc-string maybedft compl)))
    (ido-completing-read
            prompt
            compl
            nil
            t
            nil
            nil
            dft)))
</pre>
</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-ido-find-tag</span> ()
  (interactive)
  (find-tag (aw-ido-completing-read-with-default <span style="color: #8b2252;">"Tag: "</span> (tags-lazy-completion-table) nil)))
</pre>
</div>



<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">There are entries with negative indices (to force rescan), remove them.</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-imenu-entry-valid-p</span> (x)
  (<span style="color: #a020f0;">if</span> (number-or-marker-p (cdr x))
      (&lt; 0 (cdr x))
    t))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-ido-imenu-goto</span> ()
  (interactive)
  (<span style="color: #a020f0;">let</span> ((imenu-auto-rescan t))
    (imenu (aw-ido-completing-read-with-default <span style="color: #8b2252;">"Index item: "</span> (imenu--make-index-alist) 'aw-imenu-entry-valid-p))))
</pre>
</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-ido-ucs-insert</span> ()
  (interactive)
  (ucs-insert (cdr (assoc-string (ido-completing-read <span style="color: #8b2252;">"Insert: "</span>
                                                      (all-completions <span style="color: #8b2252;">""</span> (ucs-names))
                                                      nil
                                                      t)
                                 (ucs-names)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-git" class="outline-2">
<h2 id="git"><a id="sec-14" name="sec-14"></a><span class="section-number-2">14</span> git</h2>
<div class="outline-text-2" id="text-git">
</div>

<div id="outline-container-git-git.rebase..i.todo.mode." class="outline-3">
<h3 id="git-git.rebase..i.todo.mode."><a id="sec-14-1" name="sec-14-1"></a><span class="section-number-3">14.1</span> git rebase -i todo mode.</h3>
<div class="outline-text-3" id="text-git-git.rebase..i.todo.mode.">

<p>
Here is a simple major mode for the todo files created by "git rebase
-i". It allows changing the action with SPC and showing the diff with
RET.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-git-rebase-todo-change-action</span> ()
  <span style="color: #8b2252;">""</span>
  (interactive)
  (<span style="color: #a020f0;">save-excursion</span>
    (beginning-of-line)
    (<span style="color: #a020f0;">cond</span>
     ((looking-at <span style="color: #8b2252;">"pick "</span>) (replace-match <span style="color: #8b2252;">"reword "</span>))
     ((looking-at <span style="color: #8b2252;">"reword "</span>) (replace-match <span style="color: #8b2252;">"squash "</span>))
     ((looking-at <span style="color: #8b2252;">"squash "</span>) (replace-match <span style="color: #8b2252;">"edit "</span>))
     ((looking-at <span style="color: #8b2252;">"edit "</span>) (replace-match <span style="color: #8b2252;">"fixup "</span>))
     ((looking-at <span style="color: #8b2252;">"fixup "</span>) (replace-match <span style="color: #8b2252;">"pick "</span>)))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-git-rebase-get-sha</span> ()
  <span style="color: #8b2252;">""</span>
  (interactive)
  (<span style="color: #a020f0;">save-excursion</span>
    (beginning-of-line)
    (forward-word)
    (forward-word)
    (current-word)))


(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-git-rebase-show</span> ()
  (interactive)
  (<span style="color: #a020f0;">let</span> ((sha (aw-git-rebase-get-sha)))
    (<span style="color: #a020f0;">with-current-buffer</span> (get-buffer-create <span style="color: #8b2252;">"*git-rebase-todo diff*"</span>)
      (display-buffer (current-buffer) t)
      (<span style="color: #a020f0;">let</span> ((inhibit-read-only t))
        (erase-buffer)
        (call-process <span style="color: #8b2252;">"git"</span> nil (current-buffer) t <span style="color: #8b2252;">"show"</span> sha)
        (diff-mode))
      (setq buffer-read-only t))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-git-rebase-todo-mode-setup</span> ()
  (setq truncate-lines t)
  (setq aw-git-rebase-todo-mode-keymap (make-sparse-keymap))
  (define-key aw-git-rebase-todo-mode-keymap <span style="color: #8b2252;">" "</span> 'aw-git-rebase-todo-change-action)
  (define-key aw-git-rebase-todo-mode-keymap (kbd <span style="color: #8b2252;">"RET"</span>) 'aw-git-rebase-show)
  (use-local-map aw-git-rebase-todo-mode-keymap))

(<span style="color: #a020f0;">define-generic-mode</span> <span style="color: #0000ff;">aw-git-rebase-todo-mode</span>
  '(<span style="color: #8b2252;">"#"</span>)                                     <span style="color: #b22222;">; </span><span style="color: #b22222;">comments</span>
  '(<span style="color: #8b2252;">"pick"</span> <span style="color: #8b2252;">"reword"</span> <span style="color: #8b2252;">"squash"</span> <span style="color: #8b2252;">"edit"</span> <span style="color: #8b2252;">"fixup"</span>) <span style="color: #b22222;">; </span><span style="color: #b22222;">keywords</span>
  nil                                        <span style="color: #b22222;">; </span><span style="color: #b22222;">fontlock words</span>
  '(<span style="color: #8b2252;">".*/git-rebase-todo"</span>)                    <span style="color: #b22222;">; </span><span style="color: #b22222;">mode-alist</span>
  '(aw-git-rebase-todo-mode-setup)           <span style="color: #b22222;">; </span><span style="color: #b22222;">function list</span>
  <span style="color: #8b2252;">"git rebase -i todo list mode"</span>)            <span style="color: #b22222;">; </span><span style="color: #b22222;">docstring</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-git-Fast.import" class="outline-3">
<h3 id="git-Fast.import"><a id="sec-14-2" name="sec-14-2"></a><span class="section-number-3">14.2</span> Fast import</h3>
<div class="outline-text-3" id="text-git-Fast.import">

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-git-fast-import--insert-one-file</span> (filalist)
  (<span style="color: #a020f0;">let</span> ((f (car filalist))
        (rest (cdr filalist)))
    (<span style="color: #a020f0;">let</span> ((path (car f))
          (data (cdr f)))
      (insert <span style="color: #8b2252;">"M 100644 inline "</span> path <span style="color: #8b2252;">"\n"</span>)
      (<span style="color: #a020f0;">if</span> (bufferp data)
          (insert <span style="color: #8b2252;">"data "</span> (number-to-string (buffer-size data)) <span style="color: #8b2252;">"\n"</span>
                  (<span style="color: #a020f0;">with-current-buffer</span> data
                    (buffer-string)) <span style="color: #8b2252;">"\n"</span>)
        (insert <span style="color: #8b2252;">"data "</span> (number-to-string (length data)) <span style="color: #8b2252;">"\n"</span> data <span style="color: #8b2252;">"\n"</span>)))
    (<span style="color: #a020f0;">when</span> rest
      (aw-git-fast-import--insert-one-file rest))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-git-fast-import</span> (branch initial commitmsg filalist)
  <span style="color: #8b2252;">"Create one commit on specified branch containing specified files"</span>
  (<span style="color: #a020f0;">with-temp-buffer</span>
    (insert <span style="color: #8b2252;">"commit "</span> branch <span style="color: #8b2252;">"\n"</span>)
    (insert <span style="color: #8b2252;">"committer "</span> user-full-name <span style="color: #8b2252;">" &lt;"</span> user-mail-address <span style="color: #8b2252;">"&gt; now\n"</span>)
    (insert <span style="color: #8b2252;">"data "</span> (number-to-string (length commitmsg)) <span style="color: #8b2252;">"\n"</span> commitmsg <span style="color: #8b2252;">"\n"</span>)
    (<span style="color: #a020f0;">unless</span> initial
      (insert <span style="color: #8b2252;">"from "</span> branch <span style="color: #8b2252;">"^0\n"</span>))
    (insert <span style="color: #8b2252;">"deleteall\n"</span>)
    (aw-git-fast-import--insert-one-file filalist)
    (insert <span style="color: #8b2252;">"done\n"</span>)
    (shell-command-on-region (point-min) (point-max) <span style="color: #8b2252;">"git fast-import --quiet --date-format=now --done"</span>)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org" class="outline-2">
<h2 id="org"><a id="sec-15" name="sec-15"></a><span class="section-number-2">15</span> org</h2>
<div class="outline-text-2" id="text-org">

<div class="org-src-container">

<pre class="src src-emacs-lisp">(add-to-list 'auto-mode-alist '(<span style="color: #8b2252;">"\\.org\\'"</span> . org-mode))
(add-hook 'org-mode-hook 'flyspell-prog-mode t)
</pre>
</div>



<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-src-preserve-indentation t)

<span style="color: #b22222;">; </span><span style="color: #b22222;">maybe it is org-edit-src-content-indentation that I'm looking for</span>
</pre>
</div>

<p>
Enable evaluation with C-c C-c of python and sh in org-babel blocks
too (in addition to the default elisp).
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq
 org-babel-load-languages
 '((sh . t)
   (python . t)
   (emacs-lisp . t)))
</pre>
</div>

<p>
Syntax hilight. For exported code make sure htmlize package is installed.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-src-fontify-natively t)
</pre>
</div>
</div>

<div id="outline-container-org-Auto.byte.compile.after.tangling.to..el.file" class="outline-3">
<h3 id="org-Auto.byte.compile.after.tangling.to..el.file"><a id="sec-15-1" name="sec-15-1"></a><span class="section-number-3">15.1</span> Auto byte compile after tangling to .el file</h3>
<div class="outline-text-3" id="text-org-Auto.byte.compile.after.tangling.to..el.file">

<div class="org-src-container">

<pre class="src src-emacs-lisp">  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-el-byte-compile-post-tangle</span> ()
    (<span style="color: #a020f0;">let</span> ((fn (buffer-file-name)))
      (<span style="color: #a020f0;">when</span> (and fn (string-match-p <span style="color: #8b2252;">"\\.el$"</span> fn))
        (byte-compile-file fn))))
  
  (add-hook 'org-babel-post-tangle-hook 'aw-el-byte-compile-post-tangle)
</pre>
</div>
</div>
</div>

<div id="outline-container-org-Use.the.heading.path.as.CUSTOM.ID.for.export." class="outline-3">
<h3 id="org-Use.the.heading.path.as.CUSTOM.ID.for.export."><a id="sec-15-2" name="sec-15-2"></a><span class="section-number-3">15.2</span> Use the heading-path as CUSTOM<sub>ID</sub> for export.</h3>
<div class="outline-text-3" id="text-org-Use.the.heading.path.as.CUSTOM.ID.for.export.">

<p>
This makes anchor links be based on the heading names instead of
numbers. Which makes them fragile in a different way :)
</p>

<p>
aw-org-set-custom-id-everywhere can also be run interactivly to
actually set CUSTOM<sub>ID</sub> in current buffer (as opposed to the temporary
buffer used for export).
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-org-safe-path-one-safelify</span> (a)
    (replace-regexp-in-string <span style="color: #8b2252;">"[</span><span style="color: #8b2252;">^</span><span style="color: #8b2252;">a-zA-Z0-9]"</span> <span style="color: #8b2252;">"."</span> (org-no-properties a)))
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-org-safe-path</span> ()
    (<span style="color: #a020f0;">let</span> ((l (reverse (cons (org-get-heading) (reverse (org-get-outline-path))))))
      (concat (mapconcat 'aw-org-safe-path-one-safelify l <span style="color: #8b2252;">"-"</span>))))
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-org-set-custom-id</span> ()
    (org-set-property <span style="color: #8b2252;">"CUSTOM_ID"</span> (aw-org-safe-path)))
  
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-org-set-custom-id-everywhere</span> (backend)
    (interactive)
    (<span style="color: #a020f0;">save-excursion</span>
      (goto-char (point-min))
      (<span style="color: #a020f0;">while</span> (not (eobp))
        (outline-next-heading)
        (<span style="color: #a020f0;">unless</span> (org-entry-get (point) <span style="color: #8b2252;">"CUSTOM_ID"</span>)
          (aw-org-set-custom-id)))))

  (add-hook 'org-export-before-parsing-hook 'aw-org-set-custom-id-everywhere)
</pre>
</div>
</div>
</div>

<div id="outline-container-org-init.el.in.org.git.export" class="outline-3">
<h3 id="org-init.el.in.org.git.export"><a id="sec-15-3" name="sec-15-3"></a><span class="section-number-3">15.3</span> init.el in org git export</h3>
<div class="outline-text-3" id="text-org-init.el.in.org.git.export">

<p>
aw-org-tangle-and-export-to-git-branch creates a new commit on the export branch,
containing two files: the org-file exported to html, and the orgfile
tangled into el.
</p>


<div class="org-src-container">

<pre class="src src-emacs-lisp">    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-find-tangle-dest-files</span> ()
      (<span style="color: #a020f0;">let</span> ((blocks (org-babel-tangle-collect-blocks))
            res)
        (mapcar (<span style="color: #a020f0;">lambda</span> (a)
                  (mapcar (<span style="color: #a020f0;">lambda</span> (a)
                            (add-to-list 'res (cdr (assoc <span style="color: #483d8b;">:tangle</span> (nth 4 a)))))
                          (cdr a)))
                blocks)
        res))
    
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-get-tangle-dest-files</span> ()
      (mapcar (<span style="color: #a020f0;">lambda</span> (filepath)
                (cons (file-name-nondirectory filepath)
                      (<span style="color: #a020f0;">with-temp-buffer</span>
                        (insert-file-contents filepath)
                        (buffer-string))))
              (aw-find-tangle-dest-files)))
    
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-org-tangle-and-export-to-git-branch</span> (<span style="color: #228b22;">&amp;optional</span> allow-create)
      (interactive <span style="color: #8b2252;">"P"</span>)
      (<span style="color: #a020f0;">let</span> ((dd default-directory)
            (tangle-dests (aw-get-tangle-dest-files)))
        (org-babel-tangle)
        (<span style="color: #a020f0;">let</span> ((html (org-export-as 'html))
              (extra-files nil))
          (cd dd)
          (aw-git-fast-import <span style="color: #8b2252;">"refs/heads/export"</span> allow-create <span style="color: #8b2252;">"export commit"</span> `((<span style="color: #8b2252;">"index.html"</span> . ,html)
                                                                                 ,@tangle-dests)))))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-nxml" class="outline-2">
<h2 id="nxml"><a id="sec-16" name="sec-16"></a><span class="section-number-2">16</span> nxml</h2>
<div class="outline-text-2" id="text-nxml">

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">aw-setup-nxml-mode</span> ()
  (setq indent-tabs-mode nil)
  (setq nxml-child-indent 4))

(add-hook 'nxml-mode-hook 'aw-setup-nxml-mode)
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Anders Waldenborg</p>
<p class="date">Created: 2014-11-03 Mon 22:41</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.3.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>