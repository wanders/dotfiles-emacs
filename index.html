<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-02-24 lör 19:20 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Anders Waldenborg's emacs config</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Anders Waldenborg" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Anders Waldenborg's emacs config</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#Packages">1. Packages</a></li>
<li><a href="#Appearance">2. Appearance</a>
<ul>
<li><a href="#Appearance-Remove.stuff.from.the.UI.">2.1. Remove stuff from the UI.</a></li>
<li><a href="#Appearance-Show.matching.parens">2.2. Show matching parens</a></li>
<li><a href="#Appearance-Fonts">2.3. Fonts</a></li>
<li><a href="#Appearance-Large.frame">2.4. Large frame</a></li>
<li><a href="#Appearance-Header.line">2.5. Header line</a></li>
<li><a href="#Appearance-ANSI.colors">2.6. ANSI colors</a></li>
</ul>
</li>
<li><a href="#yankmenu">3. yankmenu</a></li>
<li><a href="#woman">4. woman</a></li>
<li><a href="#flycheck">5. flycheck</a></li>
<li><a href="#key.bindings">6. key-bindings</a>
<ul>
<li><a href="#key.bindings-C.c..letter.">6.1. C-c <i>letter</i></a></li>
</ul>
</li>
<li><a href="#c.mode">7. c-mode</a></li>
<li><a href="#flyspell">8. flyspell</a></li>
<li><a href="#shell">9. shell</a>
<ul>
<li><a href="#shell-Directory.in.buffer.name">9.1. Directory in buffer name</a></li>
<li><a href="#shell-Completion">9.2. Completion</a></li>
</ul>
</li>
<li><a href="#shell.script.mode">10. shell script mode</a></li>
<li><a href="#uniquify">11. uniquify</a></li>
<li><a href="#python">12. python</a></li>
<li><a href="#ido">13. ido</a></li>
<li><a href="#ediff">14. ediff</a></li>
<li><a href="#git">15. git</a>
<ul>
<li><a href="#git-magit">15.1. magit</a></li>
<li><a href="#git-running.git.from.shell.buffers">15.2. running git from shell buffers</a></li>
<li><a href="#git-Fast.import">15.3. Fast import</a></li>
</ul>
</li>
<li><a href="#org">16. org</a>
<ul>
<li><a href="#org-Auto.byte.compile.after.tangling.to..el.file">16.1. Auto byte compile after tangling to .el file</a></li>
<li><a href="#org-Use.the.heading.path.as.CUSTOM.ID.for.export.">16.2. Use the heading-path as CUSTOM<sub>ID</sub> for export.</a></li>
<li><a href="#org-init.el.in.org.git.export">16.3. init.el in org git export</a></li>
</ul>
</li>
<li><a href="#nxml">17. nxml</a></li>
</ul>
</div>
</div>
<p>
##
## Use org-babel-tangle to write the .el file.
##
</p>


<div id="outline-container-orgcc0d30b" class="outline-2">
<h2 id="Packages"><a id="orgcc0d30b"></a><span class="section-number-2">1</span> Packages</h2>
<div class="outline-text-2" id="text-Packages">
<p>
Initialize package system and add the marmalade and melpa package
repositories. This snippet comes from <a href="http://irreal.org/blog/?p=923">http://irreal.org/blog/?p=923</a>
</p>

<p>
Rumor has that it should be the very first thing in init.el, so here
we go.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">  (package-initialize)
  (add-to-list 'package-archives
               '("marmalade" . "https://marmalade-repo.org/packages/"))
  (add-to-list 'package-archives
               '("melpa" . "https://stable-melpa.org/packages/"))
</pre>
</div>
</div>
</div>

<div id="outline-container-org97c684a" class="outline-2">
<h2 id="Appearance"><a id="org97c684a"></a><span class="section-number-2">2</span> Appearance</h2>
<div class="outline-text-2" id="text-Appearance">
</div>

<div id="outline-container-org72263a0" class="outline-3">
<h3 id="Appearance-Remove.stuff.from.the.UI."><a id="org72263a0"></a><span class="section-number-3">2.1</span> Remove stuff from the UI.</h3>
<div class="outline-text-3" id="text-Appearance-Remove.stuff.from.the.UI.">
<p>
By default emacs has lots of useless UI elements, remove them to give
more room for the actual edit buffers.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(blink-cursor-mode 0)

(menu-bar-mode 0)
(tool-bar-mode 0)
(scroll-bar-mode 0)
</pre>
</div>

<p>
Now with the scrollbar out of the way, add some information about
buffer boundaries in the left fringe.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(setq-default indicate-buffer-boundaries 'left)
(setq-default indicate-empty-lines t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org0728317" class="outline-3">
<h3 id="Appearance-Show.matching.parens"><a id="org0728317"></a><span class="section-number-3">2.2</span> Show matching parens</h3>
<div class="outline-text-3" id="text-Appearance-Show.matching.parens">
<p>
Showing matching parentheses is nice. Having the whole expression
within parens highlighted when cursor is on one of the parens is even
nicer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(show-paren-mode t)
(set-face-background 'show-paren-mismatch "red")
(set-face-background 'show-paren-match "#f0f0f0")
(setq show-paren-style 'expression)
</pre>
</div>


<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; Hilight trailing whitespace
;; like this --&gt;   
;;
(setq-default show-trailing-whitespace t)
(set-face-background 'trailing-whitespace "orange1")

</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(setq compilation-scroll-output t)

(transient-mark-mode t)
(setq mouse-yank-at-point t)

(setq user-mail-address "anders@0x63.nu")
(setq inhibit-startup-screen t)
(setq calendar-week-start-day 1)

</pre>
</div>
</div>
</div>

<div id="outline-container-org6dc1976" class="outline-3">
<h3 id="Appearance-Fonts"><a id="org6dc1976"></a><span class="section-number-3">2.3</span> Fonts</h3>
<div class="outline-text-3" id="text-Appearance-Fonts">
<p>
Try to cleverly select font and size. Smaller size on laptop screen -
larger size on large screen.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun aw-font-if-exists (fontname)
  ""
  (when (find-font (font-spec :name fontname))
    fontname))

(defun aw-default-font-name ()
  ""
  (or
   (aw-font-if-exists "InputMono Light")
   (aw-font-if-exists "Input")
   (aw-font-if-exists "Inconsolata")
   (aw-font-if-exists "UbuntuMono")
   "Mono"))

(defun aw-get-font-for-frame (frame)
  "Return font with size based on how large the monitor is"
  (let* ((screen-w-mm (nth 1 (assoc 'mm-size (frame-monitor-attributes frame))))
	 (font-size (or (and screen-w-mm (&gt; screen-w-mm 400) 12) 10)))
    (format "%s-%d" (aw-default-font-name) font-size)))

(defun aw-new-frame-set-font-function (frame)
  ""
  (with-selected-frame frame
    (set-frame-font (aw-get-font-for-frame frame))))
(add-hook 'after-make-frame-functions 'aw-new-frame-set-font-function)

</pre>
</div>
</div>
</div>


<div id="outline-container-org712ba18" class="outline-3">
<h3 id="Appearance-Large.frame"><a id="org712ba18"></a><span class="section-number-3">2.4</span> Large frame</h3>
<div class="outline-text-3" id="text-Appearance-Large.frame">
<p>
Make it possible to open a new "large" frame. A fullscreen frame with
larger font is nice for pair-programming/review.
</p>

<p>
The keybinding <code>C-x 5 l</code> creates such frame.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun aw-large-frame ()
  "Create a new fullscreen frame with a larger font (for pair programming/review)."
  (interactive)
  (with-selected-frame (make-frame '((name . "Emacs Largefont frame")
		       (window-system . x)))
    (set-frame-font (format "%s-18" (aw-default-font-name)) t)
    (set-frame-parameter nil 'fullscreen 'fullboth)
    (selected-frame)))

(define-key ctl-x-5-map "l" 'aw-large-frame)

</pre>
</div>
</div>
</div>

<div id="outline-container-orgfa622be" class="outline-3">
<h3 id="Appearance-Header.line"><a id="orgfa622be"></a><span class="section-number-3">2.5</span> Header line</h3>
<div class="outline-text-3" id="text-Appearance-Header.line">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun aw-flycheck-error-message-at-point ()
  (car (delq nil
	     (mapcar
	      (lambda (o) (and (overlay-get o 'flycheck-overlay) (flycheck-error-message (overlay-get o 'flycheck-error))))
	      (overlays-at (point))))))


;; headerline contains current function and flycheck error on current line
(which-func-mode t)
(setq-default header-line-format
	      '((which-func-mode which-func-format)
		(flycheck-mode (" " (:eval (aw-flycheck-error-message-at-point))))))

</pre>
</div>
</div>
</div>

<div id="outline-container-org4adf132" class="outline-3">
<h3 id="Appearance-ANSI.colors"><a id="org4adf132"></a><span class="section-number-3">2.6</span> ANSI colors</h3>
<div class="outline-text-3" id="text-Appearance-ANSI.colors">
<p>
With white background the default ANSI colors gets a bit too
bright. Tune them down a bit.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(eval-after-load 'ansi-color
  '(progn
     (setq ansi-color-names-vector
           ["black" "#600" "#060" "#660"
            "#006" "#066" "#606" "white"])
     (setq ansi-color-map (ansi-color-make-color-map))))
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orga7777c3" class="outline-2">
<h2 id="yankmenu"><a id="orga7777c3"></a><span class="section-number-2">3</span> yankmenu</h2>
<div class="outline-text-2" id="text-yankmenu">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
;;
;; store symbol at point to killring
;;
(defun aw-kill-ring-save-symbol ()
  "Copy the symbol under point to the killring."
  (interactive)
  (let ((b (bounds-of-thing-at-point 'symbol)))
    (kill-ring-save (car b) (cdr b))))

;;
;; Stuff for popping up the yankmenu popup
;;
(defun aw-popup-menu-at-point (menu)
  "Shows popup menu at current point, not where mouse pointer happens to be"
  (let* ((pos (posn-at-point))
	 (x (car (posn-x-y pos)))
	 (y (cdr (posn-x-y pos)))
	 (win (posn-window pos)))
    
    (popup-menu menu (list (list x y) win))))


(defun aw-yankmenu-popup ()
  ""
  (interactive)
  (aw-popup-menu-at-point 'yank-menu))

</pre>
</div>
</div>
</div>

<div id="outline-container-orge3c9814" class="outline-2">
<h2 id="woman"><a id="orge3c9814"></a><span class="section-number-2">4</span> woman</h2>
<div class="outline-text-2" id="text-woman">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; Customizations for woman manual viewer

(require 'woman)

(setq woman-use-own-frame nil)


;; Stuff for grabbing headers from man pages
;;
;; Pressing 'h' in a woman buffer grabs all #include lines and puts them in the kill ring
;;
(defun aw-interesting-beginning-of-line ()
  ""
  (save-excursion
    (beginning-of-line)
    (while (looking-at "[\t ]")
      (forward-char))
    (point)))


(defun aw-interesting-end-of-line ()
  ""
  (save-excursion
    (end-of-line)
    (while (looking-at "[\t ]")
      (backward-char))
    (point)))

(defun aw-current-interesting-line ()
  ""
  (buffer-substring-no-properties
   (aw-interesting-beginning-of-line)
   (aw-interesting-end-of-line)))


(defun aw-grab-includes-from-woman ()
  ""
  (interactive)
  (save-excursion
    (goto-char (point-min))
    (while (not (looking-at "SYNOPSIS"))
      (forward-line))
    (let ((include-lines))
      (while (not (looking-at "DESCRIPTION"))
	(let ((line (aw-current-interesting-line)))
	  (and (string-prefix-p "#include" line)
	       (add-to-list 'include-lines line t)))
	(forward-line))
      (when include-lines
	(kill-new (mapconcat 'identity include-lines "\n"))
	(message "%d #include-lines added to killring" (length include-lines))))))

(defun aw-woman-hook ()
  ""
  (define-key woman-mode-map "h" 'aw-grab-includes-from-woman))

(add-hook 'woman-mode-hook 'aw-woman-hook)

</pre>
</div>
</div>
</div>

<div id="outline-container-org4797587" class="outline-2">
<h2 id="flycheck"><a id="org4797587"></a><span class="section-number-2">5</span> flycheck</h2>
<div class="outline-text-2" id="text-flycheck">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(add-hook 'after-init-hook #'global-flycheck-mode)


</pre>
</div>
</div>
</div>

<div id="outline-container-org3751501" class="outline-2">
<h2 id="key.bindings"><a id="org3751501"></a><span class="section-number-2">6</span> key-bindings</h2>
<div class="outline-text-2" id="text-key.bindings">
<p>
I've never understood the default goto-line keybinding, so I've put
goto-line directly on M-g.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key "\M-g" 'goto-line)
</pre>
</div>


<p>
The M-s prefix has several search things by default. Lets add a second
level prefix "M-s t" as a prefix for tags stuff:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key "\M-sts" 'tags-search)
(global-set-key "\M-stf" 'aw-ido-find-tag)
(global-set-key "\M-stv" 'visit-tags-file)
(global-set-key "\M-st%" 'tags-query-replace)
(global-set-key "\M-stn" 'tags-loop-continue)
</pre>
</div>

<p>
&#x2026;and while we are at it, replace the default M-. with the ido enhanced variant:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key "\M-." 'aw-ido-find-tag)
</pre>
</div>



<div class="org-src-container">
<pre class="src src-emacs-lisp">

; Adapted from andre, who probably borrowed it from someone else.
(defun cut-or-kill ()
  "If the mark is active - kill region, otherwise backward-kill-word"
  (interactive)
  (if mark-active
      (kill-region (point) (mark))
    (backward-kill-word 1)))

(global-set-key "\C-w" 'cut-or-kill)

</pre>
</div>


<p>
Default "C-h a" binding is apropos-command, which is useless. I
mostly use apropos when coding elisp and want full apropos
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key help-map "a" 'apropos)
</pre>
</div>


<p>
describe-text-properties is sometimes useful when developing
elisp, and it is some kind of help, so stick it under C-h
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key help-map "x" 'describe-text-properties)
</pre>
</div>
</div>



<div id="outline-container-org2008c60" class="outline-3">
<h3 id="key.bindings-C.c..letter."><a id="org2008c60"></a><span class="section-number-3">6.1</span> C-c <i>letter</i></h3>
<div class="outline-text-3" id="text-key.bindings-C.c..letter.">
<p>
C-c <i>letter</i> bindings are free for users to define.
This is how I define them.
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp">
; "C-c w" =&gt; Add symbol under cursor to kill ring. When programming I
;            often write a call to a new function that I need to write
;            before writing the actual function, and use this to get
;            the name into the key ring for easy paste when writing
;            the actual function.
(global-set-key "\C-cw" 'aw-kill-ring-save-symbol)
(global-set-key "\C-cy" 'aw-yankmenu-popup)
(global-set-key "\C-cn" 'flymake-goto-next-error)
(global-set-key "\C-cd" 'dictionary-search)

(global-set-key "\C-cg" 'aw-ido-imenu-goto)

; The orgtbl is really nice, make it easy to enable it on demand
(global-set-key "\C-ct" 'orgtbl-mode)

; I use untabify often enough to warrant it on a key, and lets use my
; variant that untabifies up to end of line if there is no region.
(defun aw-untabify-region-or-to-eol ()
  (interactive)
  (if mark-active
      (untabify (region-beginning) (region-end))
    (untabify (point) (point-at-eol))))
(global-set-key "\C-cu" 'aw-untabify-region-or-to-eol)


(defun aw-ensure-python-buffer-visible ()
  (interactive)
  (if python-buffer
      (switch-to-buffer-other-window python-buffer t)
    (message "No python buffer available")))

(defun aw-ensure-interesting-buffer-visible ()
  (interactive)
  (if (derived-mode-p 'python-mode)
      (aw-ensure-python-buffer-visible)
    (message "Don't know about interesting buffers for this mode")))

(global-set-key "\C-ci" 'aw-ensure-interesting-buffer-visible)


</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org78bd696" class="outline-2">
<h2 id="c.mode"><a id="org78bd696"></a><span class="section-number-2">7</span> c-mode</h2>
<div class="outline-text-2" id="text-c.mode">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun aw-str-isprefixp (str prefix)
  ""
  (let ((plen (length prefix)))
    (and (&gt;= (length str) plen)
	 (string-equal prefix (substring str 0 plen)))))

(defun aw-as-autostyles ()
  ""
  (let (res)
    (dolist (stylename (mapcar 'car c-style-alist) res)
      (if (aw-str-isprefixp stylename "auto-")
	  (setq res (cons (substring stylename 5) res))))))

(defun aw-list-str-match (lst x)
  "Return first matching entry in list of patterns"
  (if lst
      (if (string-match (car lst) x)
	  (car lst)
	(aw-list-str-match (cdr lst) x))))

(defun aw-as-find-match (matches p)
  ""
  (if p
      (or
       (aw-list-str-match matches (car p))
       (aw-as-find-match matches (cdr p)))))

(defun aw-as-hook ()
  ""
  (when (buffer-file-name)
    (message (format "Looking for style for %s" (buffer-file-name)))
    (let ((x (aw-as-find-match (aw-as-autostyles) (split-string (buffer-file-name)))))
      (when x
	(message "Using C style %s" x)
	(c-set-style (concat "auto-" x))))))



; This is based on the trick described here: http://www.emacswiki.org/emacs/SmartTabs
; but instead of macros-generating-advices it uses the indent-line-function variable
(defun aw-c-smarttab-indent-line-function ()
  (cond
   (indent-tabs-mode
    (let ((c-basic-offset fill-column)
	  (tab-width fill-column))
      (c-indent-line)))
   (t (c-indent-line))))

;
(c-add-style "aw-base"
	     '("linux"
	       (tab-width . 4)
	       (c-basic-offset . 4)
	       (c-offsets-alist . ((case-label . +)))
	       (indent-line-function . aw-c-smarttab-indent-line-function)
	       ))



;;

(c-add-style "auto-packetlogic2*"
	     '("aw-base"))

; use a strange offset to catch indentation errors.
(c-add-style "auto-xmms2*"
	     '("aw-base"
	       (tab-width . 5)
	       (c-basic-offset . 5)))

(c-add-style "auto-kernel*"
	     '("linux"))

(c-add-style "auto-/*"
	     '("aw-base"))

(add-hook 'c-mode-hook 'aw-as-hook)

; enable flyspell in C sources.
(add-hook 'c-mode-hook 'flyspell-prog-mode t)


</pre>
</div>

<p>
Setup <code>hide-ifdef</code> mode to shadow code which is disabled by ifdefs.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">  (defun aw-c-setup-hideifdef ()
    (setq hide-ifdef-shadow t)
    (setq hide-ifdef-initially t)
    (hide-ifdef-mode 1))

  (add-hook 'c-mode-hook 'aw-c-setup-hideifdef)
</pre>
</div>
</div>
</div>

<div id="outline-container-org205d559" class="outline-2">
<h2 id="flyspell"><a id="org205d559"></a><span class="section-number-2">8</span> flyspell</h2>
<div class="outline-text-2" id="text-flyspell">
<p>
Enable spell checking in text-mode buffers
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'text-mode-hook 'flyspell-mode t)
</pre>
</div>

<p>
Make flyspell use wave underlines in emacs 24.3+.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(eval-after-load 'flyspell
  '(progn
    (set-face-attribute 'flyspell-incorrect nil
                        :inherit nil
                        :underline '(:color "#cc0000" :style wave))
    (set-face-attribute 'flyspell-duplicate nil
                        :inherit nil
                        :underline '(:color "#00cc00" :style wave))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8a06708" class="outline-2">
<h2 id="shell"><a id="org8a06708"></a><span class="section-number-2">9</span> shell</h2>
<div class="outline-text-2" id="text-shell">
</div>

<div id="outline-container-org3a97b9d" class="outline-3">
<h3 id="shell-Directory.in.buffer.name"><a id="org3a97b9d"></a><span class="section-number-3">9.1</span> Directory in buffer name</h3>
<div class="outline-text-3" id="text-shell-Directory.in.buffer.name">
<p>
Use directory tracking to get the current directory in shell buffers
name. The idea is to be able to easily switch to the right buffer with
ido buffer switching.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun aw-directory-shell-buffer-name-mode-func (s)
  (rename-buffer (format "*shell[%s]*" (abbreviate-file-name (directory-file-name default-directory))) t))

(define-minor-mode aw-directory-shell-buffer-name-mode
  ""
  nil nil nil
  (if aw-directory-shell-buffer-name-mode
      (progn
	(aw-directory-shell-buffer-name-mode-func "")
	(add-hook 'comint-input-filter-functions 'aw-directory-shell-buffer-name-mode-func t t))
    (remove-hook 'comint-input-filter-functions 'aw-directory-shell-buffer-name-mode-func t)))

(add-hook 'shell-mode-hook '(lambda () (aw-directory-shell-buffer-name-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7caf01d" class="outline-3">
<h3 id="shell-Completion"><a id="org7caf01d"></a><span class="section-number-3">9.2</span> Completion</h3>
<div class="outline-text-3" id="text-shell-Completion">
<p>
When emacs-bash-completion is installed - enable it. Available as a
packet and here: <a href="https://github.com/szermatt/emacs-bash-completion">https://github.com/szermatt/emacs-bash-completion</a>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(when (require 'bash-completion nil t)
  (bash-completion-setup))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfb02f61" class="outline-2">
<h2 id="shell.script.mode"><a id="orgfb02f61"></a><span class="section-number-2">10</span> shell script mode</h2>
<div class="outline-text-2" id="text-shell.script.mode">
<p>
Basic setup for indentation in buffers editing shell scripts. Notice
sh-indent-comment to allow indentation of comment (only) lines.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun aw-setup-sh-mode ()
  (setq tab-width 8)
  (setq sh-indentation 8)
  (setq sh-basic-offset 8)
  (setq sh-indent-comment t))

(add-hook 'sh-mode-hook 'aw-setup-sh-mode)

</pre>
</div>
</div>
</div>

<div id="outline-container-orgb4e592f" class="outline-2">
<h2 id="uniquify"><a id="orgb4e592f"></a><span class="section-number-2">11</span> uniquify</h2>
<div class="outline-text-2" id="text-uniquify">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(require 'uniquify)

; server/src/foo.c client/src/foo.c
; =&gt;
; foo.c&lt;server&gt;    foo.c&lt;client&gt;
(setq uniquify-buffer-name-style 'post-forward-angle-brackets)
(setq uniquify-strip-common-suffix t)

; Rename buffers on close.
(setq uniquify-after-kill-buffer-p t)


; Don't try to be clever on *buffers*
(setq uniquify-ignore-buffers-re "^\\*")

</pre>
</div>
</div>
</div>

<div id="outline-container-org1c75dff" class="outline-2">
<h2 id="python"><a id="org1c75dff"></a><span class="section-number-2">12</span> python</h2>
<div class="outline-text-2" id="text-python">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(add-hook 'python-mode-hook 'flyspell-prog-mode t)

; waf's wscript files are python
(add-to-list 'auto-mode-alist '("wscript" . python-mode))

; Add align rules for python dicts.
; e.g allow using "C-u M-x align" to get pretty things like:
; mydict = {
;     a:        10,
;     bbbbbb:   20,
;     ccc:      30,
; }
(require 'align)
(add-to-list 'align-rules-list '(python-dict
				 (regexp . ":\\(\\s-*\\)[^#\t\n ]")
				 (modes . '(python-mode))))



; some debian startup file adds pylint-python-hook that is broken on my system
(remove-hook 'python-mode-hook 'pylint-python-hook)


(defun aw-py-docstr-p ()
  (let* ((ppss (syntax-ppss))
	 (strbeg (nth 8 ppss)))
    (when strbeg
      (save-excursion
	(goto-char strbeg)
	(looking-at "\"\"\"")))))


(defun aw-py-docstr-indent-previous-paragraph-indent-amout (start default)
  (catch 'done
    (while (looking-at "^[[:blank:]]*$")
      (if (&gt; (point) start)
	  (throw 'done default))
      (forward-line -1))
    (while (not (looking-at "^[[:blank:]]*$"))
      (if (&gt; (point) start)
	  (throw 'done default))
      (forward-line -1))
    (forward-line 1)
    (throw 'done (current-indentation))))

(defun aw-py-docstr-indent-amount ()
  (save-excursion
    (let* ((T (save-excursion
		(goto-char (nth 8 (syntax-ppss)))
		(cons (point) (current-column))))
	   (start (car T))
	   (indent (cdr T)))
      (forward-line 0)
      (if (looking-at "^[[:blank:]]*@.+: *")
	  indent
	(forward-line -1)
	(cond
	 ;; first line - use same indent as multiline string itself
	 ((&lt; (point) start) indent)

	 ;; epydoc field - indent up to colon
	 ((looking-at "^[[:blank:]]*@.+: *")
	  (save-excursion
	    (goto-char (match-end 0))
	    (current-column)))

	 ;; blank line - find previous nonblank
	 ((looking-at "^[[:blank:]]*$")
	  (aw-py-docstr-indent-previous-paragraph-indent-amout start indent))

	 ;; default - same as previous line
	 (t (current-indentation)))))))


(defun aw-py-docstr-indent-line-function ()
  (if (not (aw-py-docstr-p))
      (python-indent-line)
    (indent-line-to (aw-py-docstr-indent-amount))))

(defun aw-py-docstr-fill-paragraph (&amp;optional justify region)
  ""
  (interactive)
  (let ((paragraph-separate "[ \t\\f]*\\(@.*\\|\"\"\"[ \t\\f]*\\)?$")
	(paragraph-start "[ \t\\f]*\\(@.*\\|\"\"\"[ \t\\f]*\\)?$"))
    (python-fill-paragraph)))


(add-hook 'python-mode-hook
	  (lambda ()
	    ;; I hope we can trust that these already are local...
	    (setq indent-line-function 'aw-py-docstr-indent-line-function)
	    (setq fill-paragraph-function 'aw-py-docstr-fill-paragraph))
	  t)




</pre>
</div>
</div>
</div>

<div id="outline-container-org4fa4a9b" class="outline-2">
<h2 id="ido"><a id="org4fa4a9b"></a><span class="section-number-2">13</span> ido</h2>
<div class="outline-text-2" id="text-ido">
<p>
ido is really nice for finding files and buffer switching
</p>



<p>
Don't keep state between emacs invocations
(needs to be set before enabling ido-mode)
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(setq ido-save-directory-list-file nil)

</pre>
</div>

<p>
Load and enable ido
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(require 'ido)
(ido-mode t)

</pre>
</div>

<p>
Make sure .pyx/.y/.l files comes before their C file friends.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(setq ido-file-extensions-order '(".pyx" ".y" ".l" t))

</pre>
</div>

<p>
Default is raise-frame, which most of the time is useless.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(setq ido-default-buffer-method 'selected-window)

</pre>
</div>


<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun aw-ido-completing-read-with-default (prompt entries predicate)
  (let* ((maybedft (find-tag-default))
	 (compl (all-completions "" entries predicate))
	 (dft (assoc-string maybedft compl)))
    (ido-completing-read
	    prompt
	    compl
	    nil
	    t
	    nil
	    nil
	    dft)))

</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun aw-ido-find-tag ()
  (interactive)
  (find-tag (aw-ido-completing-read-with-default "Tag: " (tags-lazy-completion-table) nil)))

</pre>
</div>



<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; There are entries with negative indices (to force rescan), remove them.
(defun aw-imenu-entry-valid-p (x)
  (if (number-or-marker-p (cdr x))
      (&lt; 0 (cdr x))
    t))

(defun aw-ido-imenu-goto ()
  (interactive)
  (let ((imenu-auto-rescan t))
    (imenu (aw-ido-completing-read-with-default "Index item: " (imenu--make-index-alist) 'aw-imenu-entry-valid-p))))

</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun aw-ido-ucs-insert ()
  (interactive)
  (ucs-insert (cdr (assoc-string (ido-completing-read "Insert: "
                                                      (all-completions "" (ucs-names))
                                                      nil
                                                      t)
                                 (ucs-names)))))

</pre>
</div>
</div>
</div>

<div id="outline-container-orga4ad3a7" class="outline-2">
<h2 id="ediff"><a id="orga4ad3a7"></a><span class="section-number-2">14</span> ediff</h2>
<div class="outline-text-2" id="text-ediff">
<p>
vc-resolve-conflicts brings up ediff. Running a tiling window manager
so can't have ediff do crazy stuff like open a separate frame.
</p>
<pre class="example">
(setq ediff-window-setup-function 'ediff-setup-windows-plain)
</pre>
</div>
</div>
<div id="outline-container-orgcf2acbc" class="outline-2">
<h2 id="git"><a id="orgcf2acbc"></a><span class="section-number-2">15</span> git</h2>
<div class="outline-text-2" id="text-git">
</div>

<div id="outline-container-org837a618" class="outline-3">
<h3 id="git-magit"><a id="org837a618"></a><span class="section-number-3">15.1</span> magit</h3>
<div class="outline-text-3" id="text-git-magit">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setq magit-completing-read-function 'magit-ido-completing-read)
(setq git-commit-summary-max-length 70)
(setq magit-process-popup-time 0)
(global-set-key "\C-cm" 'magit-status)
</pre>
</div>
</div>
</div>


<div id="outline-container-org8e0d63f" class="outline-3">
<h3 id="git-running.git.from.shell.buffers"><a id="org8e0d63f"></a><span class="section-number-3">15.2</span> running git from shell buffers</h3>
<div class="outline-text-3" id="text-git-running.git.from.shell.buffers">
<p>
Sometimes it is nice to run 'git' from with in a shell buffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(setenv "GIT_PAGER" "")
(setenv "GIT_EDITOR" "emacsclient")
</pre>
</div>
</div>
</div>



<div id="outline-container-org7262249" class="outline-3">
<h3 id="git-Fast.import"><a id="org7262249"></a><span class="section-number-3">15.3</span> Fast import</h3>
<div class="outline-text-3" id="text-git-Fast.import">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun aw-git-fast-import--insert-one-file (filalist)
  (let ((f (car filalist))
	(rest (cdr filalist)))
    (let ((path (car f))
	  (data (cdr f)))
      (insert "M 100644 inline " path "\n")
      (if (bufferp data)
	  (insert "data " (number-to-string (buffer-size data)) "\n"
		  (with-current-buffer data
		    (buffer-string)) "\n")
	(insert "data " (number-to-string (string-bytes data)) "\n" data "\n")))
    (when rest
      (aw-git-fast-import--insert-one-file rest))))

(defun aw-git-fast-import (branch initial commitmsg filalist)
  "Create one commit on specified branch containing specified files"
  (with-temp-buffer
    (insert "commit " branch "\n")
    (insert "committer " user-full-name " &lt;" user-mail-address "&gt; now\n")
    (insert "data " (number-to-string (string-bytes commitmsg)) "\n" commitmsg "\n")
    (unless initial
      (insert "from " branch "^0\n"))
    (insert "deleteall\n")
    (aw-git-fast-import--insert-one-file filalist)
    (insert "done\n")
    (shell-command-on-region (point-min) (point-max) "git fast-import --quiet --date-format=now --done")))

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge617bb8" class="outline-2">
<h2 id="org"><a id="orge617bb8"></a><span class="section-number-2">16</span> org</h2>
<div class="outline-text-2" id="text-org">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'auto-mode-alist '("\\.org\\'" . org-mode))
(add-hook 'org-mode-hook 'flyspell-prog-mode t)
</pre>
</div>



<div class="org-src-container">
<pre class="src src-emacs-lisp">(setq org-src-preserve-indentation t)

; maybe it is org-edit-src-content-indentation that I'm looking for

</pre>
</div>

<p>
Enable evaluation with C-c C-c of python and sh in org-babel blocks
too (in addition to the default elisp).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(setq
 org-babel-load-languages
 '((shell . t)
   (python . t)
   (emacs-lisp . t)))
</pre>
</div>

<p>
Syntax hilight. For exported code make sure htmlize package is installed.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setq org-src-fontify-natively t)
</pre>
</div>
</div>

<div id="outline-container-org9edbdcd" class="outline-3">
<h3 id="org-Auto.byte.compile.after.tangling.to..el.file"><a id="org9edbdcd"></a><span class="section-number-3">16.1</span> Auto byte compile after tangling to .el file</h3>
<div class="outline-text-3" id="text-org-Auto.byte.compile.after.tangling.to..el.file">
<div class="org-src-container">
<pre class="src src-emacs-lisp">  (defun aw-el-byte-compile-post-tangle ()
    (let ((fn (buffer-file-name)))
      (when (and fn (string-match-p "\\.el$" fn))
        (byte-compile-file fn))))
  
  (add-hook 'org-babel-post-tangle-hook 'aw-el-byte-compile-post-tangle)
  
</pre>
</div>
</div>
</div>

<div id="outline-container-org89a74b3" class="outline-3">
<h3 id="org-Use.the.heading.path.as.CUSTOM.ID.for.export."><a id="org89a74b3"></a><span class="section-number-3">16.2</span> Use the heading-path as CUSTOM<sub>ID</sub> for export.</h3>
<div class="outline-text-3" id="text-org-Use.the.heading.path.as.CUSTOM.ID.for.export.">
<p>
This makes anchor links be based on the heading names instead of
numbers. Which makes them fragile in a different way :)
</p>

<p>
aw-org-set-custom-id-everywhere can also be run interactivly to
actually set CUSTOM<sub>ID</sub> in current buffer (as opposed to the temporary
buffer used for export).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">  (defun aw-org-safe-path-one-safelify (a)
    (replace-regexp-in-string "[^a-zA-Z0-9]" "." (org-no-properties a)))
  (defun aw-org-safe-path ()
    (let ((l (reverse (cons (org-get-heading) (reverse (org-get-outline-path))))))
      (concat (mapconcat 'aw-org-safe-path-one-safelify l "-"))))
  (defun aw-org-set-custom-id ()
    (org-set-property "CUSTOM_ID" (aw-org-safe-path)))
  
  (defun aw-org-set-custom-id-everywhere (backend)
    (interactive)
    (save-excursion
      (goto-char (point-min))
      (while (not (eobp))
        (outline-next-heading)
        (unless (org-entry-get (point) "CUSTOM_ID")
          (aw-org-set-custom-id)))))

  (add-hook 'org-export-before-parsing-hook 'aw-org-set-custom-id-everywhere)
  
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd3a17a7" class="outline-3">
<h3 id="org-init.el.in.org.git.export"><a id="orgd3a17a7"></a><span class="section-number-3">16.3</span> init.el in org git export</h3>
<div class="outline-text-3" id="text-org-init.el.in.org.git.export">
<p>
aw-org-tangle-and-export-to-git-branch creates a new commit on the export branch,
containing two files: the org-file exported to html, and the orgfile
tangled into el.
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp">    (defun aw-find-tangle-dest-files ()
      (let ((blocks (org-babel-tangle-collect-blocks))
            res)
        (mapcar (lambda (a)
                  (mapcar (lambda (a)
                            (add-to-list 'res (cdr (assoc :tangle (nth 4 a)))))
                          (cdr a)))
                blocks)
        res))
    
    (defun aw-get-tangle-dest-files ()
      (mapcar (lambda (filepath)
                (cons (file-name-nondirectory filepath)
                      (with-temp-buffer
                        (insert-file-contents filepath)
                        (buffer-string))))
              (aw-find-tangle-dest-files)))
    
    (defun aw-org-tangle-and-export-to-git-branch (&amp;optional allow-create)
      (interactive "P")
      (let ((dd default-directory)
            (tangle-dests (aw-get-tangle-dest-files)))
        (org-babel-tangle)
        (let ((html (org-export-as 'html))
              (extra-files nil))
          (cd dd)
          (aw-git-fast-import "refs/heads/export" allow-create "export commit" `(("index.html" . ,html)
                                                                                 ,@tangle-dests)))))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org0cd0d0a" class="outline-2">
<h2 id="nxml"><a id="org0cd0d0a"></a><span class="section-number-2">17</span> nxml</h2>
<div class="outline-text-2" id="text-nxml">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun aw-setup-nxml-mode ()
  (setq indent-tabs-mode nil)
  (setq nxml-child-indent 4))

(add-hook 'nxml-mode-hook 'aw-setup-nxml-mode)
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Anders Waldenborg</p>
<p class="date">Created: 2018-02-24 lör 19:20</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>